<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">



<mapper namespace="real_estate.mapper.RealEstateMapper">
	<cache />
	<!-- 전세 insert  -->
	<insert id="insertRealEstate_Rent" parameterType="RealEstate_rent">
		insert into REALESTATE_RENT
			(rr_id,a_name,rr_year,rr_month,rr_deposit,rr_m_price,rr_area)
		values
			(rr_seq.NEXTVAL,#{a_name},#{rr_year},#{rr_month},#{rr_deposit},0,#{rr_area})
	</insert>
	
	<!-- 매매 insert  -->
	<insert id="insertRealEstate_Trade" parameterType="RealEstate_trade">
		insert into REALESTATE_TRADE
			(rt_id,a_name,rt_year,rt_month,rt_price,rt_area)
		values
			(rt_seq.NEXTVAL,#{a_name},#{rt_year},#{rt_month},#{rt_price},#{rt_area})
	</insert>
	
	<!-- 전세 delete -->
	<delete id="deleteNRealEstate_Rent" parameterType="int">
		delete from REALESTATE_RENT
		where rr_month = #{rr_month}
	</delete>
	
	<!-- 매매 delete -->
	<delete id="deleteNRealEstate_Trade" parameterType="int">
		delete from REALESTATE_TRADE
		where rt_month = #{rt_month}
	</delete>
	
	<!-- '현대힐스테이트 2단지'  최근 전세가격 보기-->
	<select id="showMyAptRent" resultType="RealEstate_rent">
		SELECT A_NAME,RR_YEAR,RR_MONTH,ROUND(AVG( RR_DEPOSIT/RR_AREA)) "rr_deposit"
		FROM REALESTATE_RENT
		GROUP BY A_NAME,RR_MONTH,RR_YEAR
		HAVING RR_MONTH =(
 			 SELECT TO_CHAR(sysdate,'MM')-1 FROM dual
		)AND A_NAME = '현대힐스테이트 2단지'        
	</select>
	<!-- '현대힐스테이트 2단지'  최근 매매가격 보기-->
	<select id="showMyAptTrade" resultType="RealEstate_trade">
		SELECT A_NAME,RT_YEAR,RT_MONTH,ROUND(AVG( RT_PRICE/RT_AREA)) "rt_price"
		FROM REALESTATE_TRADE
		GROUP BY A_NAME,RT_MONTH,RT_YEAR
		HAVING RT_MONTH =(
 			 SELECT TO_CHAR(sysdate,'MM')-1 FROM dual
		)AND A_NAME = '현대힐스테이트 2단지'       
	</select>
	
	<!-- 현대 힐스테이트 2단지 1년치 매달 최대 최소 전세 List -->
	<select id="showMyAptRentAnnual" resultType="RealEstate_rent">
		SELECT A_NAME, RR_YEAR, RR_MONTH  , ROUND(AVG( RR_DEPOSIT/RR_AREA)) "rr_deposit"
		FROM REALESTATE_RENT
		GROUP BY RR_YEAR, RR_MONTH, A_NAME
		HAVING A_NAME='현대힐스테이트 2단지'
    	ORDER BY RR_YEAR, RR_MONTH
	</select>
	
	<!-- 현대 힐스테이트 2단지 1년치 매달 최대 최소 매매 List -->
	<select id="showMyAptTradeAnnual" resultType="RealEstate_trade">
	 	SELECT A_NAME, RT_YEAR, RT_MONTH  , ROUND(AVG( RT_PRICE/RT_AREA)) "rt_price"
		FROM REALESTATE_TRADE
		GROUP BY RT_YEAR, RT_MONTH, A_NAME
		HAVING A_NAME='현대힐스테이트 2단지'
    	ORDER BY RT_YEAR, RT_MONTH
	</select>
	
	<!-- 현대 힐스테이트 2단지 평수 별 최대 최소 List -->
	<select id="showMyAptCatArea" resultType="RealEstate_Area">
		SELECT rr."area" "area" , rr."rr_max" , rr."rr_min" , rt."rt_max", rt."rt_min"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
			FROM (
 				 SELECT  RR_AREA "area" ,MAX(RR_DEPOSIT)"rr_max", MIN(RR_DEPOSIT) "rr_min"
 					 FROM REALESTATE_RENT
  						GROUP BY A_NAME, RR_AREA
 					 HAVING A_NAME='현대힐스테이트 2단지') rr 
 			 JOIN (
    			SELECT  RT_AREA "area",MAX(RT_PRICE) "rt_max", MIN(RT_PRICE) "rt_min"
    				FROM REALESTATE_TRADE
    				GROUP BY A_NAME, RT_AREA
    				HAVING A_NAME='현대힐스테이트 2단지')rt
  			ON rr."area" = rt."area"
  			ORDER BY rr."area"
	</select>

	
</mapper>